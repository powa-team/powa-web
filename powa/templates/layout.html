<!DOCTYPE html>
<html lang="en">
  <head>
    <title>{{ title }}</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="{{ static_url('img/favicon/favicon.ico') }}">
    <link rel="shortcut icon" href="{{static_url('img/favicon/favicon.ico') }}" type="image/x-icon" />
    <meta name="msapplication-TileColor" content="#2b5797">
    <meta name="msapplication-TileImage" content="{{ static_url('img/favicon/mstile-144x144.png') }}">
    {% block header %} {% end %}
    <style>
      #mask {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 100vw;
        height: 100vh;
        position: absolute;
        top: 0;
        left: 0;
        background: #EFEFEF;
        font-family: "Roboto", sans-serif;
        text-align: center;
      }
      #mask > * {
        display: block;
      }

      [v-cloak] > * { display:none }
    </style>
  </head>
  <body>
    <div id="mask" v-cloak>
      <div>
        <div style="display: flex; align-items: center; justify-content: center; color: #859145;">
          <img src="{{ static_url('img/favicon/favicon-32x32.png')}}"/>&nbsp;<b>PoWA</b>
        </div>
        <br>
        <noscript>
          Javascript is required to display this page.
        </noscript>
        <script type="text/javascript">
          document.write("Loadingâ€¦<br>");
        </script>
        <span id="waiter"></span>
      </div>
    </div>
    <div id="app" v-cloak>
      <v-app>
        <v-app-bar
          app
          elevation="2"
          height="40px;"
        >
          <v-btn href="{{ reverse_url('Overview')}}" class="mr-2" text color="primary" elevation="0">
            <img src="{{ static_url('img/favicon/favicon-32x32.png')}}"/>&nbsp;<b>PoWA</b>
          </v-btn>
          {% if current_user %}
          <v-toolbar-title
            text
            class="mr-2 text-body-1"
          >
            Server <b>{{ handler.current_server }}</b>
            ({{ handler.current_connection }})
          </v-toolbar-title>
          <v-btn text color="primary"
            href="{{ reverse_url('RepositoryConfigOverview')}}"
            title="Configuration"
          >
            <v-icon left>
              {{! icons.mdiCog  }}
            </v-icon>
            Configuration
          </v-btn>
          {% if handler.notify_allowed %}
            <v-menu offset-y>
              <template v-slot:activator="{ on, attrs }">
                <v-btn
                  text
                  color="primary"
                  v-bind="attrs"
                  v-on="on"
                >
                  <v-icon left>
                    {{! icons.mdiReload  }}
                  </v-icon>
                  Actions
                </v-btn>
              </template>
              <v-list>
                <v-list-item link @click="reloadCollector">
                  <v-list-item-title>
                    Reload collector
                  </v-list-item-title>
                </v-list-item>
                {% if handler.server is not None %}
                <v-list-item link @click="forceSnapshot({{ handler.server }})">
                  <v-list-item-title>
                    Force a snapshot
                  </v-list-item-title>
                </v-list-item>
                {% end %}
                {% if handler.server is not None %}
                <v-list-item link @click="refreshDbCat('{{ handler.server }}', $event)"
                  {% if handler.database is not None %}
                    data-dbname="{{handler.database}}"
                  {% end %}
                >
                  <v-list-item-title>
                    Refresh catalogs
                    {% if handler.database is not None %}
                    on db {{ handler.database }}
                    {% else %}
                    on all db
                    {% end %}
                  </v-list-item-title>
                </v-list-item>
                {% end %}
              </v-list>
            </v-menu>
          {% end %}

          <v-spacer></v-spacer>

          <v-btn text color="primary"
            href="{{ reverse_url('logout') }}"
            >
            <v-icon left>
              {{! icons.mdiPower  }}
            </v-icon>
            Logout
          </v-btn>
          {% end %}
          {% if current_user %}
          <template v-slot:extension>
            <bread-crumbs :bread-crumb-items="breadCrumbItems"></bread-crumbs>
            <v-spacer></v-spacer>
            <date-range-picker ml-auto></date-range-picker>
          </template>
          {% end %}
        </v-app-bar>
        <v-main class="grey lighten-3">
          <v-container fluid>
            <v-row>
              <v-col>
                {% block content %} {% end %}
              </v-col>
            </v-row>
          </v-container>
        </v-main>
        <v-footer>
          <v-container fluid>
            <v-row>
              <v-flex>
                <ul style="margin-bottom: 0; padding-left: 0;">
                  <li style="display: inline-block">Version {{version()}}</li>
                  <li style="display: inline-block" class="ml-5">&copy; 2014-2017 Dalibo</li>
                  <li style="display: inline-block" class="ml-5">&copy; 2018-{{year()}} The PoWA-team</li>
                  <li style="display: inline-block" class="ml-5"><a href="https://powa.readthedocs.io">https://powa.readthedocs.io</a></li>
                </ul>
              </v-flex>
              <v-flex ml-auto class="text-right">
                <a href="https://github.com/powa-team/powa-web/issues">Report a bug</a>
              </v-flex>
            </v-row>
          </v-container>
        </v-footer>
        <v-snackbars :objects.sync="store.alertMessages">
          <template v-slot:default="{ message }">
            <span v-html="message"></span>
          </template>
          <template v-slot:action="{ close, index, message, id }">
            <v-icon text @click="close()">{{! icons.mdiClose }}</v-icon>
          </template>
        </v-snackbars>
      </v-app>
    </div>
    <script type="text/messages">
    {% raw to_json(dict(flashed_messages().items())) %}
    </script>
    {% if current_user %}
    <script type="text/messages">
    {% raw to_json(dict(sanitycheck_messages().items())) %}
    </script>
    {% end %}
    {% if current_user %}
<script type="text/breadcrumb">
  {% set last = len(handler.breadcrumb) - 1 %}
  {%
    raw to_json([{
      "text": item.title,
      "href": reverse_url_with_params(item.url_name, url_args=item.url_params.values()),
      "disabled": i == last,
    } for i, item in enumerate(reversed(handler.breadcrumb))] + [{
      "text": item.children_title,
      "children": [{
        "url": reverse_url_with_params(child.url_name, url_args=child.url_params.values()),
        "title": child.title
      } for child in item.children] if item.children and i == last else None
    } for i, item in enumerate(reversed(handler.breadcrumb)) if i == last and item.children])
  %}
</script>
    {% end %}
    {% if handler.application.settings['debug'] %}
      <script type="text/javascript" src="{{ static_url('js/waiter.js') }}"></script>
      <script type="module" src="http://localhost:5173/powa/static/js/main.js"></script>
    {% else %}
      {% raw inject_assets("powa/static/js/main.js") %}
    {% end %}
  </body>
</html>
